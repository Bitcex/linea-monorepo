plugins {
    id 'net.consensys.zkevm.kotlin-common-conventions'
    id 'java-library'
}

dependencies {
  api "org.web3j:core:${versions.web3j}"
  api project(':jvm-libs:core:domain-models')
  api project(':jvm-libs:logging')
  implementation "tech.pegasys.teku.internal:jackson:${versions["teku"]}"

  testImplementation "org.apache.logging.log4j:log4j-slf4j2-impl:2.20.0"
  testImplementation "com.fasterxml.jackson.core:jackson-annotations:${versions.jackson}"
  testImplementation "com.fasterxml.jackson.core:jackson-databind:${versions.jackson}"
}

jar {
    dependsOn configurations.runtimeClasspath
}

sourceSets {
  integrationTest {
    kotlin {
      compileClasspath += main.output
      runtimeClasspath += main.output
    }
    compileClasspath += sourceSets.main.output + sourceSets.main.compileClasspath + sourceSets.test.compileClasspath
    runtimeClasspath += sourceSets.main.output + sourceSets.main.runtimeClasspath + sourceSets.test.runtimeClasspath
  }
}

tasks.register('integrationTest', Test) {
  test ->
    description = "Runs integration tests."
    group = "verification"
    useJUnitPlatform()

    classpath = sourceSets.integrationTest.runtimeClasspath
    testClassesDirs = sourceSets.integrationTest.output.classesDirs

    dependsOn(":localStackComposeUp")
}


check.finalizedBy("integrationTest")
